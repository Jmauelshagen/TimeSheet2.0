@using Timesheet.Models
@using System.Diagnostics
@model Timesheet.Models.TimeSheet
@using System.Diagnostics


@{
    Layout = null;
    string totalHours = "";
    string totalweekly = "";
    int hour = 0;
    int hours = 0;
    int minute = 0;
    int minutes = 0;
}

<!--This is the Supervisor role's view of time sheets, and has the capability to approve or deny
    a time sheet.-->
<!DOCTYPE html>
<link rel="stylesheet" href="~/Content/Style.css" type="text/css" />

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Reports</title>
</head>
<body>
    <!--Get employee, time sheet list and message objects from the session.-->
    @{  var emp = (Employee)Session["Employee"];
        var reportTimeList = (List<TimeSheet>)Session["TimeSheetList"];
        var message = (string)Session["Message"];
    }

    <div>
        <center>
            <img src="~/Content/ChatLogo.jpg" alt="ChatLogo" height="250" width="1520" />
        </center>
    </div>
    <div>
        <h1>Reports</h1>
        <br />
        <!--Form for supervisor to select an employee by name and a week ending date.-->
        <p>Select Employee</p>
        @using (Html.BeginForm("ReportData", "Reports", FormMethod.Post, new { role = "form" }))
        {
            @Html.LabelFor(x => x.Name)
            @Html.DropDownListFor(x => x.Name,
                  Model.EmpNames,
                  "-Select Employee-",
                  new { @class = "form-control" })

            @Html.LabelFor(x => x.WeekEnding)
            @Html.DropDownListFor(x => x.WeekEnding,
                  Model.WeekEndingDates,
                  "-Select A Date-",
                  new { @class = "form-control" })

        <button type="submit">Search</button>
}
        <br />
        <!--Display message content if it exists.-->
        @{
            if (@message != null)
            {
                <p style="text-align: center; color: white;">@message</p>
            }
        }

        <!--Table for viewing time sheet data.-->
        <table style="width:100%" cellpadding="4">
            <tr>
                <th></th>
                <th>Week end</th>
                <th>Date</th>
                <th>Start/ Time In</th>
                <th>Meal/ Time Out</th>
                <th>Meal/ Time In</th>
                <th>Finish/ Time Out</th>
                <th>Type of absence</th>
                <th>Absent hours</th>
                <th>Additional Hours</th>
                <th>Hours Worked</th>
                <th>Over Time</th>
                <th>Submitted</th>
                <th>Authorized</th>
            </tr>
            @{
                if (@reportTimeList != null)
                {
                    foreach (TimeSheet reporttime in @reportTimeList)
                    {
                    <tr>
                        <td></td>
                        <td>@reporttime.WeekEnding</td>
                        <td>@reporttime.Date</td>
                        <td>@reporttime.TimeIn</td>
                        <td>@reporttime.OutForLunch</td>
                        <td>@reporttime.InFromLunch</td>
                        <td>@reporttime.TimeOut</td>
                        <td>@reporttime.LeaveId</td>
                        <td>@reporttime.LeaveHours</td>
                        <td>@reporttime.AdditionalHours</td>
                        @{ /** Calculates the hours worked for the day **/
                            string TotalHoursWorked = reporttime.TotalHoursWorked.ToString().Trim();
                            Debug.WriteLine(TotalHoursWorked + "in total Hours");
                            if (TotalHoursWorked.Equals("NoTime"))
                            {
                                TotalHoursWorked = "0";
                                <td>@TotalHoursWorked</td>
                            }
                            else if (!TotalHoursWorked.Equals("Error"))//&& !tsheets[i].TotalHoursWorked.ToString().Trim().Equals("0"))
                            {
                                Debug.WriteLine("Passed the if");
                                <td>@TotalHoursWorked</td>
                            }
                            else
                            {
                                Debug.WriteLine("Failed the if");
                                TotalHoursWorked = "Error";
                                <td bgcolor="red">@TotalHoursWorked</td>
                            }
                        }
                        <td>
                        @{ /** Calculates the hours worked for the day **/
                            Debug.WriteLine(TotalHoursWorked + "DailyTimesheet TotalHours Test 2 for overtime");
                            string overtime;
                            if (TotalHoursWorked.Equals("0"))
                            {
                                overtime = "0";
                            }
                            else if (!TotalHoursWorked.Equals("Error"))
                            {
                                Debug.WriteLine("Calculating Hours Worked in the DailyTimesheet");
                                hour = Convert.ToInt16(TotalHoursWorked.Split(':')[0]);
                                minute = Convert.ToInt16(TotalHoursWorked.Split(':')[1]);
                                if (minute >= 60)
                                {
                                    minute = minute - 60;
                                    hour = hour + 1;
                                }
                                totalHours = hour + ":" + minute;

                                /** Calculates and overtime for the day **/
                                int hoursWorked2 = Convert.ToInt16(totalHours.Split(':')[0]);
                                int minutesWorked = Convert.ToInt16(totalHours.Split(':')[1]);
                                if (hoursWorked2 < 8)
                                {
                                     overtime = "0";
                                }
                                else
                                {
                                    overtime = (hoursWorked2 - 8) + ":" + minutesWorked;
                                }
                            }
                            else
                            {
                                overtime = "0";
                            }

                        }
                        @overtime
                        </td>
                        <td>@reporttime.Submitted</td>
                        <td>@reporttime.AuthorizedBySupervisor</td>
                    </tr>

                    }
                }

            }
        </table>
        <br />
        <!--Forms to approve or deny time sheet.-->
        @using (Html.BeginForm("Approve", "Reports", FormMethod.Post, new { role = "form" }))
    {
        <button type="submit">Approve</button>
}
        @using (Html.BeginForm("Deny", "Reports", FormMethod.Post, new { role = "form" }))
    {
        <button type="submit">Deny</button>
}
        <br />
        <!--Like to go back-->
        <a href="#" onclick="history.back();">Back</a>
        <br />
        <!--Log out link.-->
        <a href="@Url.Action("LogOut","Login")">LogOut</a>
    </div>
</body>
</html>






